# Stock Analysis And Prediction
웹 스크래핑과 LSTM을 활용한 주가 예측&분석 프로젝트

---

## 🔍 목차

<details>
<summary>목차 보기 (클릭)</summary>

1. [프로젝트 개요](#-프로젝트-개요)  
2. [기술 스택](#-기술-스택)   
3. [데이터 수집](#-데이터-수집)  
4. [데이터 전처리](#-데이터-전처리)  
5. [모델링](#-모델링)  
6. [결과 및 평가](#-결과-및-평가)  
7. [향후 계획](#-향후-계획)  

</details>

---

## 📋 프로젝트 개요

**목표)**  
- 과거 주가 데이터를 활용해 다음 날 시가를 예측하고, 이를 통해 의사결정에 도움을 주는 모델 개발

**역할)**  
- 웹 스크래핑: 네이버 금융에서 일별 주가 데이터 자동 수집  
- 데이터 전처리: 결측치 처리와 스케일링, 시퀀스 생성 파이프라인 설계  
- 모델 개발: LSTM 네트워크 구현 및 하이퍼파라미터 튜닝  
- 결과 시각화: 학습·검증 손실과 예측 결과를 자동으로 플롯하고 저장

**성과)**  
- MAPE(평균 절대 백분율 오차) 1% 미만 달성  
- 전체 예측 그래프와 최근 N일 확대 그래프 자동 저장 기능 구현  

---

## 🛠 기술 스택

- **언어**: Python 3.8+  
- **웹 스크래핑**: urllib (*Request*, *urlopen*), BeautifulSoup  
- **데이터 전처리**: pandas, numpy, scikit-learn (*StandardScaler*)  
- **모델링**: TensorFlow/Keras (*Sequential*, *LSTM*, *Dense*, *Adam*)  
- **모델 평가**: scikit-learn (*mean_squared_error*, *r2_score*, *mean_absolute_percentage_error*)  
- **시각화**: Matplotlib 

---

## 📊 데이터 수집

- **소스**: [네이버 금융 일별 시세 – 삼성전자(005930)](https://finance.naver.com/item/sise_day.naver?code=005930)
- **형태**:
  ![네이버 주가](images/naver_stock.PNG)   

---

## 🧹 데이터 전처리

1. **문자열 정제**  
   - `volatility`에서 `%` 제거 후 숫자만 추출  
     ```
     df['volatility'] = df['volatility'].str.extract(r'([\d\.]+)').astype(float)
     ```
   - 나머지 피처(`close`, `open`, `high`, `low`, `volume`)를 `float(실수)` 형태로 변환  
     ```
     df[['close','open','high','low','volume']] = df[['close','open','high','low','volume']].astype(float)
     ```

2. **날짜 처리 & 정렬**  
   - `date`를 `datetime(날짜)` 타입으로 변환  
     ```
     df['date'] = pd.to_datetime(df['date'], format='%Y.%m.%d')
     ```
   - 오름차순 정렬 및 인덱스 재설정  
     ```
     df.sort_values('date', inplace=True)
     df.reset_index(drop=True, inplace=True)
     ```

3. **스케일링**  
   - `StandardScaler`로 정규화
     ```
     scaler = StandardScaler()
     X_scaled = scaler.fit_transform(df[features].values)
     ```
4. **데이터 분할**
   - 전체 데이터의 70%를 학습용 데이터로, 30%를 테스트용 데이터로 분할
   ```python
   n_train  = int(len(df) * 0.7)
   train_df = df.iloc[:n_train]
   test_df  = df.iloc[n_train:]

5. **시퀀스 생성**  
   - 7 거래일 단위(`seq_len = 7`)로 다음 날 예측(`pred_steps = 1`):
     ```
     X, y = preprocessor.create_sequences(X_scaled, seq_len = 7, pred_steps = 1)
     ```
     
**전처리 후 데이터셋의 모습 (첫 5행)**

| date       |   close   | volatility |    open   |    high   |     low    |     volume    |
|------------|-----------|------------|-----------|-----------|------------|---------------|
| 2020-10-07 |  59900.0  |    900.0   |  58700.0  |  59900.0  |  58500.0   | 14861838.0    |
| 2020-10-08 |  59700.0  |    200.0   |  60500.0  |  60700.0  |  59500.0   | 24589924.0    |
| 2020-10-12 |  60400.0  |    700.0   |  60000.0  |  60400.0  |  59900.0   | 16145837.0    |
| 2020-10-13 |  60900.0  |    500.0   |  61000.0  |  61400.0  |  60400.0   | 19247631.0    |
| 2020-10-14 |  60900.0  |      0.0   |  61000.0  |  61100.0  |  60500.0   | 16086716.0    |

---

## 🧠 모델링

- **하이퍼파라미터**  
  | 파라미터      | 값    |
  |---------------|------|
  | seq_len       | 7    |
  | batch_size    | 32   |
  | epochs        | 30   |
  | learning_rate | 0.01 |

- **학습 코드**  
  ```python
  model = LSTMModel(seq_len = 7, n_features = X.shape[2], lr = 0.01)
  history = model.train(trainX, trainY, epochs = 30, batch_size = 32)

---

## 📈 결과 및 평가

- **평가지표**  
  | 지표  | 값            |
  |------|--------------|
  | MSE  | 860050.46 |
  | R²   | 0.98       |
  | MAPE | 0.94%        |

- **학습/검증 손실 그래프**  
  ![학습 손실](images/loss.png)  

- **전체 예측 그래프 (23.08.16 ~ 24.10.30)**  
  ![전체 예측](images/predictions.png)  

- **최근 거래일 예측 그래프 (24.09.11 ~ 24.10.30)**  
  ![최근 확대](images/predictions_zoom.png)

- **다음 날(24.10.31) 시가 분석**  
  | 날짜       | 예측 시가     | 실제 시가     | 절대 오차   | 백분율 오차 |
  |-----------|--------------|--------------|------------|-----------|
  | 2024-10-31 | 59,212.94원 | 58,500.00원 | 712.94원  | 1.22%     |

- **주요 인사이트**  
  - 평균적으로 실제 시가 대비 **0.97%** 오차 발생 → 매우 높은 정확도  
  - 급등락 구간에서는 예측 오차가 다소 커지는 경향 확인
 
  - - **RMSE (Root MSE)**  
  \(\sqrt{860\,050.46} \approx 927.6\)원  
  - MSE 하나만으로는 오차 규모가 와닿지 않는데, RMSE를 보면 평균적으로 약 927원 정도 차이가 납니다.

- **R² = 0.98 해석**  
  - 전체 시가 변동의 98%를 모델이 설명  
  - 남은 2%는 예측 불가능한 잡음이나 외부 이슈 영향일 가능성이 높습니다.

- **손실 곡선 수렴 시점**  
  - `loss.png`를 보면 학습·검증 손실이 **약 15~20 epoch** 사이에서 평행하게 안정됨  
  - 이 시점 이후엔 과적합 없이 추가 학습 효과가 미미합니다.

- **다음 날 시가 예측 정확도**  
  - 예측값: **59,212.94원** vs 실제값: **58,500원**  
  - 절대 오차: 712.94원 / 백분율 오차: 1.22%  
  - 1거래일 예측 치고는 매우 우수한 결과

- **MAPE = 0.94% 의 의미**  
  - 평균적으로 실제 시가 대비 1% 미만의 오차  
  - 주가 예측 모델 중에서도 상위권 성능에 해당

- **테스트 구간 예측 일관성**  
  - 전체 테스트 기간(전체 데이터의 마지막 30%, 예측 시작일: `dates.iloc[n_train+6].date()`)에서  
    **MAPE < 1%**가 꾸준히 유지됨 → 모델이 장기·단기 모두 안정적으로 작동
 
---

## 🚀 향후 계획

- **실시간 대시보드 개발**  
  - Streamlit 기반 웹앱으로 예측 결과·손실 곡선을 실시간 모니터링  

- **LLM 연계 자동 보고서 생성**  
  - 예측 결과와 주요 지표를 ChatGPT 등 대형 언어 모델과 연결해  
  - 자연어로 요약·인사이트 리포트를 자동 작성  

- **컨테이너 배포 & CI/CD 구축**  
  - Docker 이미지로 패키징 후  
  - GitHub Actions로 자동 빌드·테스트·배포 파이프라인 구성  
